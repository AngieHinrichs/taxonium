##### Welcome to the Taxonium documentation

```{toctree}
:hidden:
:caption: Reference

index.md
taxoniumtools.md
```

Taxonium is a tool for exploring phylogenetic trees. The web interface can be accessed at [taxonium.org](https://taxonium.org/) and the source code repository at [https://github.com/theosanderson/taxonium](https://github.com/theosanderson/taxonium).

## Getting started

### Viewing a Newick tree

If you have a tree in Newick format and you just want to view it, you can just go to [Taxonium.org](http://taxonium.org), and select your tree file. 

```{image} https://user-images.githubusercontent.com/19732295/169146746-4a31799a-66cf-4490-b925-ca17abf6af61.png
:width: 60em
:class: no-scaled-link
```

Or just drag and drop the file into the Taxonium window.

#### Adding metadata to your tree

Optionally, you can also upload a metadata file with your tree. This file should be in TSV or CSV format. It should have a heading with column names. The left-most column should contain the node names as used in the Newick file. The remaining columns should contain metadata for each node.

```{image} https://user-images.githubusercontent.com/19732295/169146935-6f40721a-7457-480a-85ed-185e5daaa205.png
:width: 60em
:class: no-scaled-link
```


```{eval-rst}
.. note::
    All files supplied to Taxonium can also have .gz extensions, indicating they are gzipped.
```

### Viewing the global SARS-CoV-2 tree

We maintain an instance of Taxonium that displays a version of the UShER-built SARS-CoV-2 global tree, at [Cov2Tree.org](http://cov2tree.org).

```{image} https://user-images.githubusercontent.com/19732295/169147139-8f67e297-9d0c-4707-9e92-95827498e24d.png
:width: 60em
:class: no-scaled-link
```


### Using an UShER mutation annotated tree

Taxonium is especially powerful when applied to a tree that has been annotated with mutations. With these trees it can allow searching for mutations, or displaying genotypes. Such trees are often generated by [UShER](https://github.com/yatisht/usher/). Please refer to the UShER documentation for advice on how to make such a tree.

:::{note}
Sometimes you might just want to annotate an existing SARS-CoV-2 tree. You can download MATs pre-built by the UShER team from [here](https://hgwdev.gi.ucsc.edu/~angie/UShER_SARS-CoV-2/), which you can add your own metadata to using `taxonium_to_usher`.
:::

Once you have an UShER-annotated tree, we provide a tool for converting it to a format that Taxonium can use. The Taxonium format is a JSONL file with a list of nodes, each with all of its metadata, and a position. To create such a file we can use the `usher_to_taxonium` tool, from the `taxoniumtools` package.

You can read in detail about [how to use usher_to_taxonium](./taxoniumtools.md).


### Advanced topics

#### Permalinks with the Taxonium web interface

You can supply files locally to the Taxonium web interface, or you can supply URLs for the files.

:::{note}
Any files must be uploaded to somewhere that allows Cross-Origin Resource Sharing (CORS).
:::

If you supply purely URLs, then you will find that the Taxonium.org interface encodes them in the URL as it loads the tree, meaning you can share your tree with other people by copying the URL. In addition, any searches or colouring of the tree will also be stored in the URL. Each search will have a permalink button that will create a URL that zooms in on those particular nodes.

#### Deploying your own Taxonium backend

All of the description above involves the full tree being processed wholly locally in your own browser. For very large trees, this can mean a lot of memory and that the initial loading process is quite slow. To solve this issue, you can deploy your own Taxonium backend which will run continually in some cloud server, ready to receive traffic and emit a small part of the tree to a client.

This is probably best done with Docker:

```{bash}
docker run -p 80:80 -e "DATA_URL=https://cov2tree.nyc3.cdn.digitaloceanspaces.com/latest_public.jsonl.gz" -e "CONFIG_JSON=config_public.json" theosanderson/taxonium_backend:master
```

or

```{bash}
docker run -p 80:80 -v myfile.jsonl.gz:/data/myfile.jsonl.gz -v myconfig.json:/data/myconfig.json -e "DATA_FILE=/data/myfile.jsonl.gz" -e "CONFIG_JSON=/data/myconfig.json" theosanderson/taxonium_backend:master
```
